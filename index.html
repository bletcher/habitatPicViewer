<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fish Data Visualizations | SHEDS</title>

  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="libs/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="libs/landing-page/css/landing-page.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="libs/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="libs/leaflet/dist/leaflet.css" rel="stylesheet" type="text/css">

  <style>
    body, h1, h2, h3, h4, h5, h6 {
      font-weight: 400;
      font-family: "Open Sans", Helvetica, Arial, sans-serif !important;
    }

    .top-section {
      background: #222;
      color: white;
    }
    
    .funding-section img {
      margin: 10px 25px 10px 25px;
    }

    #mapwest {
      height: 225px;
      width: 350px;
      margin: 0 10px;
      display: block;
      margin: auto;
      width: 85%;
    }

    #mapstanley {
      height: 225px;
      width: 350px;
      margin: 0 10px;
      display: block;
      margin: auto;
      width: 85%;
    }

    div.tooltip {
      position: absolute;
      padding: 8px;
      font: 12px sans-serif;
      background: #C6C6C6;
      pointer-events: none;
      height: auto;
      width: 480px;
      text-align: center;
    }
    
    .object-fit_contain { object-fit: contain }
    
    img[class] { 
      width: 100%;
    }
    
  </style>
</head>
<body>

  <div style="border-bottom: 2px solid #e7e7e7;background:#f8f8f8">
    <div class="container">
      <div class="row" style="margin-top: 20px; margin-bottom: 20px">
        <div class="col-xs-12">
          <h1>Fish Tagging Studies Introduction</h1>
        </div>
      </div>
    </div>
  </div>

  <div class="content-section-b top-section">
    <div class="container">
      <div class="row" style="margin-top: 20px; margin-bottom: 40px">
        <div class="col-md-4">
          <h2>What is a tagging study?</h2>
          <p style="font-size:1.2em;">Understanding the performance and fate of individual fish helps us understand why populations fluctuate and why species come and go.</p>
          <p style="font-size:1.2em;">Since 1997, we have studied stream fish using <a href="https://en.wikipedia.org/wiki/Radio-frequency_identification" target="_blank"> tags </a>that contain unique electronic codes. We can estimate body growth, movement and reproduction (performance) and survival (fate) by recapturing tagged fish over time. </p>
          <p style="font-size:1.2em;">Our two longest-running tagging studies are the West Brook, in Whately MA and Stanley Brook in 
          Seal Harbor, Maine. Dots on the maps are 20m-long or 40-m long (Stanley) sampling sections. Mouse over a section in the West Brook to see a picture of the section from 2006. Get a tour of the data by <a href="/PITtagOverview/index.html"> launching </a>the introduction.</p>

        </div>

        <div class="col-md-8">

          <div class="col-md-6 text-center" style="margin-top: 40px">
            <h3>West Brook, MA</h3>
            <div>
              <div id="mapwest"></div>
            </div>
          </div>
          
          <div class="col-md-6 text-center" style="margin-top: 40px">
            <h3>Stanley Brook, ME</h3>
            <div>
              <div id="mapstanley"></div>
            </div>
          </div>
          
          <div class="row" >
            <div class="col-md-4 col-md-offset-4 text-center" style="margin-top: 20px">
               <p><a class="btn btn-lg btn-primary" style="margin-top: 25px" href="/PITtagOverview/index.html" target="_blank">Launch Intro <span class="glyphicon glyphicon-chevron-right"></span></a></p>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>
  
  <div class="content-section-a">
    <div class="container">
      <div class="row" style="margin-top: 40px">
        <div class="col-md-6">

          <h2>Want a detailed look at the data?</h2>

          <p>
            This <a href="/fish-movements/index.html" target="_blank">application</a> shows the locations of individual fish over time. Watch the fish from West Brook or Stanley Brook move from season to season and see who lives and dies. Individuals, all fish from a sampling section, river or even family (in some years) can be selected to see how groups of fish move around and how long they survive.
          </p>
        </div>
        <div class="col-md-6 text-center">
          <a href="/fish-movements/index.html" target="_blank">
            <img src="/img/thumb-select-watershed.png" class="img-rounded" alt="Web pic" width="500" height="267">
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="content-section-b">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8">
          <h2>Project Team</h2>
          <p>Ben Letcher initiated the West Brook study in 1997 with Gabe Gries. Since then the study has been a collaboration among the <a href="http://www.lsc.usgs.gov/?q=cafb-population-dynamics-personnel" target="_blank">USGS Conte Laboratory</a> (Ben Letcher, Matt O'Donnell, Todd Dubreuil), the <a href="http://www.nrs.fs.fed.us/people/knislow" target="_blank">USFS Northern Research Station</a> (Keith Nislow, Jason Coombs), and the <a href="http://eco.umass.edu/" target="_blank">University of Massachusetts Department of Environmental Conservation</a> (<a href="http://www.cfc.umt.edu/personnel/details.php?ID=4461" target="_blank">Andrew Whiteley</a> - now at The University of Montana). </p>
           <p>Ben Letcher and Matt O'Donnell started the Stanley Brook study in 2006 with <a href="http://www.coopunits.org/Maine/People/Joseph_Zydlewski/" target="_blank">Joe Zydlewski </a> from <a href="https://umaine.edu/wle/faculty-staff-directory/" target="_blank">the University of Maine </a> and Bruce Connery of the <a href="https://www.nps.gov/acad/index.htm" target="_blank">National Park Service </a>.</p>
           <p>We thank the many graduate students, interns, post-docs and others who have helped sample the streams over the years. </p>
        </div>
      </div>
    </div>
  </div>


  <div class="content-section-a">
    <div class="container">
      <div class="row">
        <h2>Funding Sources</h2>
        <p> <a href="http://www.lsc.usgs.gov/?q=cafb-population-dynamics-personnel" target="_blank">USGS Conte Laboratory</a> and 
        <a href="http://www.nrs.fs.fed.us/" target="_blank">USFS Northern Research Station</a>, with additional funding from:

        <div class="row">
          <div class="col-lg-12 text-center funding-section">
            <a href="http://www.nature.org/ourinitiatives/regions/northamerica/areas/connecticutriver/index.htm"><img src="img/logo-tnc.png" alt="TNC Logo"></a>
            <a href="https://necsc.umass.edu/"><img src="img/logo-necsc.png" alt="NECSC Logo"></a>
            <a href="http://northatlanticlcc.org/"><img src="img/logo-nalcc.jpg" alt="NALCC Logo"></a>
            <a href="http://www.usgs.gov"><img src="img/logo-usgs.png" alt="USGS Logo"></a>
            <a href="http://www.doi.gov"><img src="img/logo-doi.png" alt="DOI Logo"></a>
            <a href="http://www.usgs.gov/hurricane/sandy/#overview.html"><img src="img/logo-sandy.png" alt="USGS Sandy Logo"></a>

          </div>
        </div>   
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <p class="copyright text-muted">Copyright Â© 2016 SHEDS Development Team</p>
          <p class="copyright text-muted"><strong>Disclaimer:</strong> This web site (SHEDS) has not yet been approved by the U.S. Geological Survey (USGS). As such, it does not represent any official USGS finding or policy.</p>
        </div>
      </div>
    </div>
  </footer>



<script src="libs/leaflet/dist/leaflet.js"></script>
<script src="libs/d3/d3.min.js"></script>

<script>

var app = {
  state:  {
    selectedWatershed: 'west'
  }
}

var riverNames = {
  'West Brook': 'WB',
  'WB Mitchell': 'OS',
  'WB Jimmy': 'OL',
  'WB Obear': 'IL',
  'east': 'east',
  'west': 'west',
  'mainstem': 'mainstem',
  'tidal': 'tidal',
};

var featureWest, featureStanley;

// read in data
d3.queue()
  .defer(d3.csv, 'data/coordsForD3JS.csv')
  .await(function (error, coords) {
    if (error) {
      alert('Error occurred while loading the data.');
      throw error;
    }

  app.locations = coords;
  console.log(app)

  app.locations.forEach(function (d) {
    d.lat = +d.lat;
    d.lon = +d.lon;
    d.river = riverNames[d.riverFull];
    d.LatLng = new L.LatLng(d.lat, d.lon)
  });

// map for West ///
  var latLonCenter = [42.434, -72.669],
      zoom = 15
      
  var locationsWest = app.locations.filter(function(d){return d.watershed == app.state.selectedWatershed})

  var mapWest = L.map('map' + app.state.selectedWatershed).setView(latLonCenter, zoom);

  L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(mapWest);
  
  mapWest._initPathRoot();
  
  
  var year = 2006, season = 1;
  var locationsMap,featureWest;
  
  var svg = d3.select("#map" + app.state.selectedWatershed).select("svg"),
      g = svg.append("g");
  
  var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);
  
  
    var riverColors = d3.scaleOrdinal(d3.schemeCategory10)
      .domain(['WB', 'OS', 'OL', 'IL']);
  
    featureWest = g.selectAll("circle")
      .data(locationsWest)
      .enter().append("circle")
      .style("stroke", function(d) { return d3.rgb(riverColors(d.river)).darker(1); })
      .style("fill", function(d) { return riverColors(d.river); })
      .style("opacity", 0.6)
      .attr("r", 4)
      .on("mouseover", function(d) {
        d3.select(this)
          .attr("r", 8)
          .style("stroke", "red")
          .style("fill", "lightgrey");
  
        var fileName = "img/" + d.river + "_" + year + "_" + season + "_" + d.section + ".jpg";
        
        tooltip.html('<h3>River = ' + d.riverFull + ", Section = " + d.section + '</h3><br><img class="object-fit-contain" src= ' + fileName + '>')
           .style("left", "80px")// (d3.event.pageX + 15) + "px")
           .style("top",  "200px")// (d3.event.pageY - 15) + "px")
           .transition()
           .duration(100)
           .style("opacity", 1);
      })
      .on("mouseout", function (d) {
        d3.select(this)
          .attr("r", 4)
          .style("stroke", function(d) { return d3.rgb(riverColors(d.river)).darker(1); })
          .style("fill", function(d) { return riverColors(d.river); });
  
         tooltip.transition()
           .duration(250)
           .style("opacity", 0);
      });
      
  mapWest.on("viewreset", onViewResetWest)
  onViewResetWest();
  
  function onViewResetWest() {
    featureWest.attr("transform", function(d) {
      return "translate(" + mapWest.latLngToLayerPoint(d.LatLng).x + "," +
                            mapWest.latLngToLayerPoint(d.LatLng).y + ")";
    });
  }
  
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // repeat for Stanley, inefficient, but fast ////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////
  app.state.selectedWatershed = 'stanley';
  latLonCenter = [44.303, -68.242]
  zoom = 13
      
  var locationsStanley = app.locations.filter(function(d){return d.watershed == app.state.selectedWatershed})

  var mapStanley = L.map('map' + app.state.selectedWatershed).setView(latLonCenter, zoom);

  L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(mapStanley);
  
  mapStanley._initPathRoot();
  
  
  var year = 2006, season = 1;
  var locationsMap,featureStanley;
  
  var svg = d3.select("#map" + app.state.selectedWatershed).select("svg"),
      g = svg.append("g");
  
    var riverColors = d3.scaleOrdinal(d3.schemeCategory10)
      .domain(['WB', 'OS', 'OL', 'IL']);
  
    featureStanley = g.selectAll("circle")
      .data(locationsStanley)
      .enter().append("circle")
      .style("stroke", function(d) { return d3.rgb(riverColors(d.river)).darker(1); })
      .style("fill", function(d) { return riverColors(d.river); })
      .style("opacity", 0.6)
      .attr("r", 4)
      .on("mouseover", function(d) {
        d3.select(this)
          .attr("r", 8)
          .style("stroke", "red")
          .style("fill", "lightgrey");
  
        var fileName = "img/" + d.river + "_" + year + "_" + season + "_" + d.section + ".jpg";
        
        tooltip.html('<h3>River = ' + d.riverFull + ", Section = " + d.section + '</h3><br><img class="object-fit-contain" src= ' + fileName + '>')
           .style("left", "80px")// (d3.event.pageX + 15) + "px")
           .style("top",  "200px")// (d3.event.pageY - 15) + "px")
           .transition()
           .duration(100)
           .style("opacity", 1);
      })
      .on("mouseout", function (d) {
        d3.select(this)
          .attr("r", 4)
          .style("stroke", function(d) { return d3.rgb(riverColors(d.river)).darker(1); })
          .style("fill", function(d) { return riverColors(d.river); });
  
         tooltip.transition()
           .duration(250)
           .style("opacity", 0);
      });
      
  mapStanley.on("viewreset", onViewResetStanley)
  onViewResetStanley();
  
  function onViewResetStanley() {
    featureStanley.attr("transform", function(d) {
      return "translate(" + mapStanley.latLngToLayerPoint(d.LatLng).x + "," +
                            mapStanley.latLngToLayerPoint(d.LatLng).y + ")";
    });
  }  

});


</script>

</body>
</html>